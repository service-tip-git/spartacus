<section *ngIf="!(isLoading$ | async); else loading">
  <div
    *cxFeature="'!a11yRemoveStatusLoadedRole'"
    role="status"
    [attr.aria-label]="'common.loaded' | cxTranslate"
  ></div>

  <form [formGroup]="registerForm" (ngSubmit)="submit()">
    <p *cxFeature="'a11yRequiredAsterisks'" class="form-legend">
      {{ 'formLegend.required' | cxTranslate }}
    </p>
    <label>
      <span class="label-content">{{
        'userRegistrationForm.fields.titleCode.label' | cxTranslate
      }}</span>
      <ng-select
        id="title-code-select"
        formControlName="titleCode"
        [searchable]="false"
        [clearable]="false"
        [items]="titles$ | async"
        bindLabel="name"
        bindValue="code"
        placeholder="{{
          'userRegistrationForm.fields.titleCode.placeholder' | cxTranslate
        }}"
        [cxNgSelectA11y]="{
          ariaLabel:
            'userRegistrationForm.fields.titleCode.label' | cxTranslate,
        }"
      >
      </ng-select>
    </label>

    <label>
      <span class="label-content required"
        >{{ 'userRegistrationForm.fields.firstName.label' | cxTranslate
        }}<ng-template [ngTemplateOutlet]="requiredAsterisk"></ng-template
      ></span>
      <input
        required="true"
        class="form-control"
        type="text"
        name="firstname"
        placeholder="{{
          'userRegistrationForm.fields.firstName.placeholder' | cxTranslate
        }}"
        formControlName="firstName"
        [attr.aria-describedby]="'firstNameError'"
      />

      <!-- TODO: (CXSPA-7315) Remove feature toggle in the next major -->
      <cx-form-errors
        *cxFeature="'formErrorsDescriptiveMessages'"
        id="firstNameError"
        aria-live="off"
        [translationParams]="{
          label: 'userRegistrationForm.fields.firstName.label' | cxTranslate,
        }"
        [control]="registerForm.get('firstName')"
      ></cx-form-errors>

      <cx-form-errors
        *cxFeature="'!formErrorsDescriptiveMessages'"
        [control]="registerForm.get('firstName')"
      ></cx-form-errors>
    </label>

    <label>
      <span class="label-content required"
        >{{ 'userRegistrationForm.fields.lastName.label' | cxTranslate
        }}<ng-template [ngTemplateOutlet]="requiredAsterisk"></ng-template
      ></span>
      <input
        required="true"
        class="form-control"
        type="text"
        name="lastname"
        placeholder="{{
          'userRegistrationForm.fields.lastName.placeholder' | cxTranslate
        }}"
        formControlName="lastName"
        [attr.aria-describedby]="'lastNameError'"
      />

      <!-- TODO: (CXSPA-7315) Remove feature toggle in the next major -->
      <cx-form-errors
        *cxFeature="'formErrorsDescriptiveMessages'"
        id="lastNameError"
        aria-live="off"
        [translationParams]="{
          label: 'userRegistrationForm.fields.lastName.label' | cxTranslate,
        }"
        [control]="registerForm.get('lastName')"
      ></cx-form-errors>

      <cx-form-errors
        *cxFeature="'!formErrorsDescriptiveMessages'"
        [control]="registerForm.get('lastName')"
      ></cx-form-errors>
    </label>

    <label>
      <span class="label-content required"
        >{{ 'userRegistrationForm.fields.companyName.label' | cxTranslate
        }}<ng-template [ngTemplateOutlet]="requiredAsterisk"></ng-template
      ></span>
      <input
        required="true"
        class="form-control"
        type="text"
        name="companyName"
        placeholder="{{
          'userRegistrationForm.fields.companyName.placeholder' | cxTranslate
        }}"
        formControlName="companyName"
        [attr.aria-describedby]="'companyNameError'"
      />
      <cx-form-errors
        *cxFeature="'formErrorsDescriptiveMessages'"
        id="companyNameError"
        aria-live="off"
        [translationParams]="{
          label: 'userRegistrationForm.fields.companyName.label' | cxTranslate,
        }"
        [control]="registerForm.get('companyName')"
      ></cx-form-errors>
      <cx-form-errors
        *cxFeature="'!formErrorsDescriptiveMessages'"
        [control]="registerForm.get('companyName')"
      ></cx-form-errors>
    </label>

    <label>
      <span class="label-content required"
        >{{ 'userRegistrationForm.fields.email.label' | cxTranslate
        }}<ng-template [ngTemplateOutlet]="requiredAsterisk"></ng-template
      ></span>
      <input
        required="true"
        class="form-control"
        type="email"
        name="email"
        placeholder="{{
          'userRegistrationForm.fields.email.placeholder' | cxTranslate
        }}"
        formControlName="email"
        [attr.aria-describedby]="'emailError'"
      />

      <!-- TODO: (CXSPA-7315) Remove feature toggle in the next major -->
      <cx-form-errors
        *cxFeature="'formErrorsDescriptiveMessages'"
        id="emailError"
        aria-live="off"
        [translationParams]="{
          label: 'userRegistrationForm.fields.email.label' | cxTranslate,
        }"
        [control]="registerForm.get('email')"
      ></cx-form-errors>

      <cx-form-errors
        *cxFeature="'!formErrorsDescriptiveMessages'"
        [control]="registerForm.get('email')"
      ></cx-form-errors>
    </label>

    <ng-container
      *ngIf="countries$ | async as countries"
      formGroupName="country"
    >
      <label *ngIf="countries.length !== 0">
        <span class="label-content">{{
          'userRegistrationForm.fields.country.label' | cxTranslate
        }}</span>
        <ng-select
          class="country-select"
          id="country-select"
          formControlName="isocode"
          [searchable]="true"
          [clearable]="false"
          [items]="countries"
          bindLabel="name"
          bindValue="isocode"
          placeholder="{{
            'userRegistrationForm.fields.country.placeholder' | cxTranslate
          }}"
          [cxNgSelectA11y]="{
            ariaLabel:
              'userRegistrationForm.fields.country.label' | cxTranslate,
          }"
        >
        </ng-select>

        <!-- TODO: (CXSPA-7315) Remove feature toggle in the next major -->
        <cx-form-errors
          *cxFeature="'formErrorsDescriptiveMessages'"
          [translationParams]="{
            label: 'userRegistrationForm.fields.country.label' | cxTranslate,
          }"
          [control]="registerForm.get('country.isocode')"
        ></cx-form-errors>

        <cx-form-errors
          *cxFeature="'!formErrorsDescriptiveMessages'"
          [control]="registerForm.get('country.isocode')"
        ></cx-form-errors>
      </label>
    </ng-container>

    <label>
      <span class="label-content">{{
        'userRegistrationForm.fields.addressLine.label' | cxTranslate
      }}</span>
      <input
        type="text"
        class="form-control"
        placeholder="{{
          'userRegistrationForm.fields.addressLine.placeholder' | cxTranslate
        }}"
        formControlName="line1"
        [attr.aria-describedby]="'line1Error'"
      />

      <!-- TODO: (CXSPA-7315) Remove feature toggle in the next major -->
      <cx-form-errors
        *cxFeature="'formErrorsDescriptiveMessages'"
        id="line1Error"
        aria-live="off"
        [translationParams]="{
          label: 'userRegistrationForm.fields.addressLine.label' | cxTranslate,
        }"
        [control]="registerForm.get('line1')"
      ></cx-form-errors>

      <cx-form-errors
        *cxFeature="'!formErrorsDescriptiveMessages'"
        [control]="registerForm.get('line1')"
      ></cx-form-errors>
    </label>

    <label>
      <span class="label-content">{{
        'userRegistrationForm.fields.secondAddressLine.label' | cxTranslate
      }}</span>
      <input
        type="text"
        class="form-control"
        placeholder="{{
          'userRegistrationForm.fields.secondAddressLine.placeholder'
            | cxTranslate
        }}"
        formControlName="line2"
        [attr.aria-describedby]="'line2Error'"
      />
      <cx-form-errors
        id="line2Error"
        aria-live="off"
        [control]="registerForm.get('line2')"
      ></cx-form-errors>
    </label>

    <label>
      <span class="label-content">{{
        'userRegistrationForm.fields.city.label' | cxTranslate
      }}</span>
      <input
        type="text"
        class="form-control"
        placeholder="{{
          'userRegistrationForm.fields.city.label' | cxTranslate
        }}"
        formControlName="town"
        [attr.aria-describedby]="'townError'"
      />
      <cx-form-errors
        id="townError"
        aria-live="off"
        [control]="registerForm.get('town')"
      ></cx-form-errors>
    </label>

    <label>
      <span class="label-content">{{
        'userRegistrationForm.fields.postalCode.label' | cxTranslate
      }}</span>
      <input
        type="text"
        class="form-control"
        placeholder="{{
          'userRegistrationForm.fields.postalCode.placeholder' | cxTranslate
        }}"
        formControlName="postalCode"
        [attr.aria-describedby]="'postalCodeError'"
      />

      <!-- TODO: (CXSPA-7315) Remove feature toggle in the next major -->
      <cx-form-errors
        *cxFeature="'formErrorsDescriptiveMessages'"
        id="postalCodeError"
        aria-live="off"
        [translationParams]="{
          label: 'userRegistrationForm.fields.postalCode.label' | cxTranslate,
        }"
        [control]="registerForm.get('postalCode')"
      ></cx-form-errors>

      <cx-form-errors
        *cxFeature="'!formErrorsDescriptiveMessages'"
        [control]="registerForm.get('postalCode')"
      ></cx-form-errors>
    </label>

    <ng-container *ngIf="regions$ | async as regions" formGroupName="region">
      <label *ngIf="regions.length !== 0">
        <span class="label-content">{{
          'userRegistrationForm.fields.state.label' | cxTranslate
        }}</span>
        <ng-select
          class="region-select"
          formControlName="isocode"
          [searchable]="true"
          [clearable]="false"
          [items]="regions"
          bindLabel="name"
          bindValue="isocode"
          placeholder="{{
            'userRegistrationForm.fields.state.placeholder' | cxTranslate
          }}"
          id="region-select"
          [cxNgSelectA11y]="{
            ariaLabel: 'userRegistrationForm.fields.state.label' | cxTranslate,
          }"
        >
        </ng-select>

        <!-- TODO: (CXSPA-7315) Remove feature toggle in the next major -->
        <cx-form-errors
          *cxFeature="'formErrorsDescriptiveMessages'"
          [translationParams]="{
            label: 'userRegistrationForm.fields.state.label' | cxTranslate,
          }"
          [control]="registerForm.get('region.isocode')"
        ></cx-form-errors>

        <cx-form-errors
          *cxFeature="'!formErrorsDescriptiveMessages'"
          [control]="registerForm.get('region.isocode')"
        ></cx-form-errors>
      </label>
    </ng-container>

    <label>
      <span class="label-content">{{
        'userRegistrationForm.fields.phoneNumber.label' | cxTranslate
      }}</span>
      <input
        type="tel"
        class="form-control"
        placeholder="{{
          'userRegistrationForm.fields.phoneNumber.placeholder' | cxTranslate
        }}"
        formControlName="phoneNumber"
        [attr.aria-describedby]="'phoneNumberError'"
      />

      <!-- TODO: (CXSPA-7315) Remove feature toggle in the next major -->
      <cx-form-errors
        *cxFeature="'formErrorsDescriptiveMessages'"
        id="phoneNumberError"
        aria-live="off"
        [translationParams]="{
          label: 'userRegistrationForm.fields.phoneNumber.label' | cxTranslate,
        }"
        [control]="registerForm.get('phoneNumber')"
      ></cx-form-errors>

      <cx-form-errors
        *cxFeature="'!formErrorsDescriptiveMessages'"
        [control]="registerForm.get('phoneNumber')"
      ></cx-form-errors>
    </label>

    <label>
      <span class="label-content">{{
        'userRegistrationForm.fields.message.label' | cxTranslate
      }}</span>
      <textarea
        class="form-control"
        formControlName="message"
        placeholder="{{
          'userRegistrationForm.fields.message.placeholder' | cxTranslate
        }}"
        rows="5"
        [attr.aria-describedby]="'messageError'"
      ></textarea>

      <!-- TODO: (CXSPA-7315) Remove feature toggle in the next major -->
      <cx-form-errors
        *cxFeature="'formErrorsDescriptiveMessages'"
        id="messageError"
        aria-live="off"
        [translationParams]="{
          label: 'userRegistrationForm.fields.message.label' | cxTranslate,
        }"
        [control]="registerForm.get('message')"
      ></cx-form-errors>

      <cx-form-errors
        *cxFeature="'!formErrorsDescriptiveMessages'"
        [control]="registerForm.get('message')"
      ></cx-form-errors>
    </label>

    <button type="submit" class="btn btn-block btn-primary">
      {{ 'userRegistrationForm.formSubmitButtonLabel' | cxTranslate }}
    </button>
    <a
      class="cx-login-link btn-link"
      [routerLink]="{ cxRoute: 'login' } | cxUrl"
      >{{ 'userRegistrationForm.goToLoginButtonLabel' | cxTranslate }}</a
    >
  </form>
</section>

<ng-template #loading>
  <div class="cx-spinner"><cx-spinner></cx-spinner></div>
</ng-template>

<ng-template #requiredAsterisk>
  <abbr
    *cxFeature="'a11yRequiredAsterisks'"
    class="text-decoration-none required-asterisk"
    aria-hidden="true"
    title="{{ 'common.required' | cxTranslate }}"
    >*</abbr
  >
</ng-template>
